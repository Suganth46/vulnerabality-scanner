import { scanWebsite } from './api.js';
import { updateUI } from './ui.js';
import { displayResults } from './results.js';
import { initializeChart } from './chart.js';

document.addEventListener('DOMContentLoaded', () => {
    const scanForm = document.getElementById('scanForm');
    const targetUrl = document.getElementById('targetUrl');
    const scanButton = document.getElementById('scanButton');
    const scanProgress = document.getElementById('scanProgress');
    const resultsContainer = document.getElementById('resultsContainer');
    const loadingOverlay = document.querySelector('.loading-overlay');
    const toast = document.getElementById('toast');

    let isScanning = false;

    initializeChart();

    scanForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (isScanning) return;
        
        const url = targetUrl.value.trim();
        if (!url) return;

        const selectedChecks = Array.from(document.querySelectorAll('input[name="checks"]:checked'))
            .map(checkbox => checkbox.value);

        try {
            isScanning = true;
            updateUI.startScan(scanButton, loadingOverlay, scanProgress);
            
            const data = await scanWebsite(url, selectedChecks);
            displayResults(resultsContainer, data);
            updateUI.showToast(toast, 'Scan completed successfully!', 'success');
        } catch (err) {
            updateUI.showToast(toast, err.message, 'error');
            resultsContainer.innerHTML = '';
        } finally {
            isScanning = false;
            updateUI.endScan(scanButton, loadingOverlay, scanProgress);
        }
    });
});